<!DOCTYPE html>
<html>
<title>CMS CSN1</title>
<meta http-equiv="expires" content="Sun, 01 Jan 2014 00:00:00 GMT"/>
<meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="pragma" content="no-cache" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<head>

<style>

.chkdiv {
	 display: inline-block;
}

label {
	padding-right: 4px;
       }
fieldset {
          border-color: green;
          background-color: #ffffff;
}
.astab {
       background-color: #aaffee;
}

html {
  font-family:Montserrat,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  line-height:1.5
}

.allafooter {
  position: fixed;
  left: 66%;
  bottom: 0;
  width: 33%;
  background-color: red;
  color: white;
  text-align: center;
}


</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>
var mfilt="";

function aggiorna(myid) {
       $("#entra").load("anedita.php?q="+myid);
    document.getElementById('id04').style.display='block';

};

function aggiornaDB(myid,myfla) {
       $("#entra").load("toggladb.php?q="+myid+"&f="+myfla); 

       
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       

};


function aggiungiResp(idp,anno,sez,nome,cognome){
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
		      //alert(this.responseText);
		      showSingleRichie(idp);
      }
      else {
         if (this.readyState == 4 && this.status != 200)    
//		      document.getElementById('id03').style.display='block';
		      alert("insert error"); 
      };
    }

      let prj=document.getElementById('respprj').value;
      let lvl=document.getElementById('resplvl').value;
      let ruo=document.getElementById('respruo').value;
      let coco=document.getElementById('respcoco').value;
      let ini=document.getElementById('respini').value;
      let fin=document.getElementById('respfin').value;
      let note=document.getElementById('respnote').value;

      let mstr= "idp="+idp+"&anno="+anno+"&sez="+sez+"&prj="+prj+"&ruo="+ruo+"&lvl="+lvl+"&coco="+coco+"&ini="+ini+"&fin="+fin+"&note="+note+"&nome="+nome+"&cognome="+cognome;
//	alert(mstr);	
    xmlhttp.open('GET',"respentra.php?"+mstr,true);
    xmlhttp.send();

};

function rimuoviResp(idp,rid){
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
                      //alert(this.responseText);
                      showSingleRichie(idp);
      }
      else {
         if (this.readyState == 4 && this.status != 200)
//                    document.getElementById('id03').style.display='block';
                      alert("insert error");
      };
    }

      let mstr= "idp="+idp+"&rid="+rid;
//      alert(mstr);
    xmlhttp.open('GET',"resprimo.php?"+mstr,true);
    xmlhttp.send();

};


function aggiornaAnag(idp,anno){
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
//                      alert(this.responseText);
                      showSingleRichie(idp);
      }
      else {
         if (this.readyState == 4 && this.status != 200)    
//                    document.getElementById('id03').style.display='block';
                      alert("insert error"); 
      };
    }

      let perccms=document.getElementById('perccms').value;
      let sin1=document.getElementById('sin1').value;
      let percs1=document.getElementById('percs1').value;
      let sin2=document.getElementById('sin2').value;
      let percs2=document.getElementById('percs2').value;
      let sin3=document.getElementById('sin3').value;
      let percs3=document.getElementById('percs3').value;

      let mstr= "idp="+idp+"&anno="+anno+"&perccms="+perccms+"&sin1="+sin1+"&percs1="+percs1+"&sin2="+sin2+"&percs2="+percs2+"&sin3="+sin3+"&percs3="+percs3;
//      alert(mstr);    
    xmlhttp.open('GET',"percedit.php?"+mstr,true);
    xmlhttp.send();

};

function nuova() {


 //   window.location="entra.html";
//    document.getElementById("txtHint").innerHTML ="";
//    fetch("entra.html").then(x => x.text()).then(y=>document.getElementById("txtHint").innerHTML =y);
////an   $("#entra").load("entra.html");
////an    document.getElementById('id04').style.display='block';
//    console.log("you loaded the form"); 
//    var theform=document.getElementById("myentr");
//    theform.action="/cmscsn1/entra.php";


//    theform.addEventListener("submit", function(event){
//       event.preventDefault();
//       fetch(theform.action, {
//          method: "post",
//          body: new URLSearchParams(new FormData(theform)) // for application/x-www-form-urlencoded
//        // body: new FormData(form) // for multipart/form-data
//    }) 
//      .then(x=>x.text())
//      .then(y => document.getElementById("demo").innerHTML = y);
//        console.log("you submitted the form");
//    });
//    showRichie(richie.value);

};

function showRichie(str) {
  if (str == "") {
    document.getElementById("txtHint").innerHTML = "";
    return;
  } else {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
        document.getElementById("totrichieste").innerHTML = document.getElementById("phprich").innerHTML;
        document.getElementById("totcms").innerHTML = document.getElementById("phpkeur").innerHTML;
        document.getElementById("totsin").innerHTML = document.getElementById("phpkeurSJ").innerHTML;
      }
      else {
	 if (this.readyState == 4 && this.status != 200)   document.getElementById('id03').style.display='block';
      };
    };
    mfilt="";
   mfilts="";
   if (BA.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'BA')>0  ";
   }
   if (BO.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'BO')>0  ";
   }
   if (CT.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'CT')>0  ";
   }
   if (FI.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'FI')>0  ";
   }
   if (GE.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'GE')>0  ";
   }
   if (LNF.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'LNF')>0  ";
   }
   if (LNL.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'LNL')>0  ";
   }
   if (MIB.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'MIB')>0  ";
   }
   if (NA.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'NA')>0  ";
   }
   if (PD.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PD')>0  ";
   }
   if (PG.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PG')>0  ";
   }
   if (PI.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PI')>0  ";
   }
   if (PV.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PV')>0  ";
   }
   if (RM1.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'RM1')>0  ";
   }
   if (TO.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'TO')>0  ";
   }
   if (TS.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'TS')>0  ";
   }
   if (mfilts!="") {
      if (mfilt!=""){ mfilt+=" AND ";}; 	   
     mfilt+="("+mfilts+") ";
   }
   mfilts="";	  
   if (cms.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='cms' ";
   }
   if (fase2.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='fase2' ";
   }
   if ((cms.checked != true) && (fase2.checked != true)) mfilts="sigla=''";
   if (mfilts!="") {
      if (mfilt!=""){ mfilt+=" AND ";}; 	   
     mfilt+="("+mfilts+") ";
   }
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='inventario' ";
//  }
//   if (trasporti.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='trasporti' ";
//   }
//   if (pubblicazioni.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='pubblicazioni' ";
//   }
// if (licenze-sw.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='licenze-sw' ";
//   }
// if (manutenzione.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='manutenzione' ";
//   }
// if (seminari.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='seminari' ";
//   }
// if (altroconsumo.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='altroconsumo' ";
//   }

//   if (RN.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " rn is not null ";
//   }
   if (agg.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " aggio='1' ";
   }
//   if (p2024.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//     mfilt+= " INSTR(tag,'P2024')>0 ";
//   }
    lfilt="";
    if (lfilt!="") mfilt+="AND ("+lfilt+") ";

   mtoke=0;
   if (assgn.checked == true) {
      mtoke=1+mtoke;

   }
 
   if (asse.checked == true) {
      mtoke=10;
      xmlhttp.open("GET","anastrdb.php?q="+str+"&f="+mfilt+"&t="+mtoke,true);
   }
   else xmlhttp.open("GET","anna.php?q="+str+"&f="+mfilt+"&t="+mtoke,true);

    xmlhttp.send();
  }
}
function showSingleRichie(str) {
  if (str == "") {
    document.getElementById("txtHint").innerHTML = "";
    return;
  } else {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
        document.getElementById("totrichieste").innerHTML = document.getElementById("phprich").innerHTML;
        document.getElementById("totcms").innerHTML = document.getElementById("phpkeur").innerHTML;
        document.getElementById("totsin").innerHTML = document.getElementById("phpkeurSJ").innerHTML;
      }
      else {
	 if (this.readyState == 4 && this.status != 200)    document.getElementById('id03').style.display='block';
      };
    };

   mfilts="";
   if (cms.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='cms' ";
   }
   if (fase2.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='fase2' ";
   }
//    if ((cms.checked != true) && (fase2.checked != true)) mfilts="";
//	alert("q="+str+" t="+richie.value+" f="+mfilts);	  
  if (richie.value==0) {
	 alert("Seleziona Anno");
   }
  else {
    xmlhttp.open("GET","anaunna.php?q="+str+"&f="+mfilts+"&t="+richie.value,true);
    xmlhttp.send();
    }
   }
}

function insertRichie() {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
      }
      else {
	if (this.readyState == 4 && this.status != 200)    document.getElementById('id03').style.display='block';
      };
    };
    xmlhttp.open("GET","entra.html",true);
    xmlhttp.send();
}


</script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://webanalytics.web.cern.ch/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '639']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
<body onload="showRichie(richie.value);">
 <div class="w3-container w3-teal ">
  <h1>Anagrafica CMS</h1>
<div class="w3-display-topright">
  <a href="alla.html" class="w3-btn w3-green">Richieste</a>
  <a href="#" class="w3-btn w3-green">Anagrafica</a>
</div>
 </div>
<form>
<!--
<select id="richie" onchange="showRichie(this.value);" onblur="this.selectedIndex = 0;">
-->

<div>  <br> </div>
<select class="w3-select, w3-quarter" id="richie" onchange="showRichie(this.value);" >
  <option value="0">Anno:</option>
  <option value="2026">2026</option>
  <option value="2025">2025</option>
  <option value="2024">2024</option>
    <option value="2023">2023</option>
    <option value="2022">2022</option>
    <option value="2021">2021</option>
    <option value="2020">2020</option>
    <option value="2019">2019</option>
    <option value="2018">2018</option>
    </select>
</form>
<!---<div class="w3-right">
<label for="vai">Vai a CMS-ID:</label>
<input type="text" id="vai" onchange="showSingleRichie(this.value);">
<span> &nbsp   </span>
</div>
--->

<br>
<table class="w3-table">
<tr>
<td>
<fieldset >
<legend> Sigla </legend>
<input type="radio" id="cms" name="sigla" value="cms"  onclick="showRichie(richie.value);">
<label for="cms">CMS</label>
<input type="radio" id="fase2" name="sigla" value="fase2"  onclick="showRichie(richie.value);">
<label for="fase2">Fase2</label>
</fieldset>
</td>
<td>
</td>
<td>
</td>

<td>
<fieldset>
<legend> Sezione </legend>
<div class="chkdiv">
<input type="checkbox" id="BA" name="BA" value="BA" onclick="showRichie(richie.value);">
<label for="BA">BA</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="BO" name="BO" value="BO" onclick="showRichie(richie.value);">
<label for="BOl">BO</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="CT" name="CT" value="CT" onclick="showRichie(richie.value);">
<label for="CT">CT</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="FI" name="FI" value="FI" onclick="showRichie(richie.value);">
<label for="FI">FI</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="GE" name="GE" value="GE" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="GE">GE</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="LNF" name="LNF" value="LNF" onclick="showRichie(richie.value);">
<label for="LNF">LNF</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="LNL" name="LNL" value="LNL" onclick="showRichie(richie.value);">
<label for="LNL">LNL</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="MIB" name="MIB" value="MIB" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="MIB">MIB</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="NA" name="NA" value="NA" onclick="showRichie(richie.value);">
<label for="NA">NA</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PD" name="PD" value="PD" onclick="showRichie(richie.value);">
<label for="PD">PD</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PG" name="PG" value="PG" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="PG">PG</label>
<input type="checkbox" id="PI" name="PI" value="PI" onclick="showRichie(richie.value);">
<label for="PI">PI</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PV" name="PV" value="PV" onclick="showRichie(richie.value);">
<label for="PV">PV</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="RM1" name="RM1" value="RM1" onclick="showRichie(richie.value);">
<label for="RM1">RM1</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="TO" name="TO" value="TO" onclick="showRichie(richie.value);">
<label for="TO">TO</labeb>
</div>
<div class="chkdiv">
<input type="checkbox" id="TS" name="TS" value="TS" onclick="showRichie(richie.value);">
<label for="TO">TS</label>
</div>
</fieldset>
</td>
<td>
<fieldset>
<legend> Views </legend>
</div>
<div class="chkdiv">
<input type="checkbox" id="asse" name="asse" value="Ass." onclick="showRichie(richie.value);">
<label for="asse">Sommario/StringheDB </label>
</div>
<div class="chkdiv">
<input type="checkbox" id="assgn" name="assgn" value="assgn" onclick="showRichie(richie.value);">
<label for="agg">Responsabilita</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="agg" name="agg" value="agg" onclick="showRichie(richie.value);">
<label for="agg">agg. </label>
</div>
</td>
<td>
<fieldset>
<legend> Azioni </legend>
<input type="button" id="Nuova"" name="Edita" value="Nuova" onclick="nuova();">
</td>
</tr>
</table>

<!-- The Modal -->
<div id="id01" class="w3-modal">
  <div class="w3-modal-content">
    <div class="w3-container">
      <span onclick="document.getElementById('id01').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <p>Richiesta inserita..</p>
    </div>
  </div>
</div> 

<!-- The Modal -->
<div id="id02" class="w3-modal">
  <div class="w3-modal-content">
    <div class="w3-container">
      <span onclick="document.getElementById('id02').style.display='none';showRichie(richie.value);" class="w3-button w3-display-topright">&times;</span>
      <p>Richiesta aggiornata..</p>
    </div>
  </div>
</div> 

<div id="id03" class="w3-modal">
  <div class="w3-modal-content">
    <div class="w3-container">
      <span onclick="document.getElementById('id03').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <p>Connection issues...</p>
      <p>Reload page and try to re-authenticate</p>
    </div>
  </div>
</div> 

<div id="id04" class="w3-modal w3-animate-zoom" >
  <div class="w3-modal-content" style="width:1250px;">
    <div class="w3-container" >
       <div id="entra"> </div>
    </div>
  </div>
</div>

<br>
<div id="txtHint"><b>Anagrafica...</b></div>
<div id="allafooter" class="allafooter">Persone:<span id="totrichieste"></span> Tot FTE:<span id="totcms"></span><span> Tot FTE Sin:</span><span id="totsin"></span> </div>
</body>
</html>
