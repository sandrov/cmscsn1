<!DOCTYPE html>
<html>
<title>CMS CSN1</title>
<meta http-equiv="expires" content="Sun, 01 Jan 2014 00:00:00 GMT"/>
<meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="pragma" content="no-cache" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<head>

<style>

.chkdiv {
	 display: inline-block;
}

label {
	padding-right: 4px;
       }
fieldset {
          border-color: green;
          background-color: #ffffff;
}
.astab {
       background-color: #aaffee;
}

html {
  font-family:Montserrat,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;
  line-height:1.5
}

.allafooter {
  position: fixed;
  left: 66%;
  bottom: 0;
  width: 33%;
  background-color: red;
  color: white;
  text-align: center;
}


</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>
var mfilt="";

function aggiorna(myid) {

};

function aggiornaDB(myid,myfla) {

       
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       showSingleRichie(myid);
       

};


function nuova() {


 //   window.location="entra.html";
//    document.getElementById("txtHint").innerHTML ="";
//    fetch("entra.html").then(x => x.text()).then(y=>document.getElementById("txtHint").innerHTML =y);
//    console.log("you loaded the form"); 
//    var theform=document.getElementById("myentr");
//    theform.action="/cmscsn1/entra.php";


//    theform.addEventListener("submit", function(event){
//       event.preventDefault();
//       fetch(theform.action, {
//          method: "post",
//          body: new URLSearchParams(new FormData(theform)) // for application/x-www-form-urlencoded
//        // body: new FormData(form) // for multipart/form-data
//    }) 
 //      .then(x=>x.text())
 //      .then(y => document.getElementById("demo").innerHTML = y);
//        console.log("you submitted the form");
//    });
//    showRichie(richie.value);

};

function showRichie(str) {
  if (str == "") {
    document.getElementById("txtHint").innerHTML = "";
    return;
  } else {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
        document.getElementById("totrichieste").innerHTML = document.getElementById("phprich").innerHTML;
        document.getElementById("totkeur").innerHTML = document.getElementById("phpkeur").innerHTML;
        document.getElementById("totkeurSJ").innerHTML = document.getElementById("phpkeurSJ").innerHTML;
        document.getElementById("totassegna").innerHTML = document.getElementById("phpasse").innerHTML;
      }
      else {
	 if (this.readyState == 4 && this.status != 200)   document.getElementById('id03').style.display='block';
      };
    };
    mfilt="";
   if (tk.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'TRACK')>0 ";
   }
   if (ecal.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'ECAL')>0 ";
   }
   if (mtd.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'MTD')>0 ";
   }
   if (mu.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
		   mfilt+= "(INSTR(tag,'MUON')>0 OR INSTR(tag,'DT')>0 OR INSTR(tag,'RPC')>0 OR INSTR(tag,'ME0')>0 OR INSTR(tag,'GEM')>0)";
   }
   if (trig.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'TRIG')>0 ";
   }
   if (pps.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'PPS')>0 ";
   }
   if (bril.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'BRIL')>0 ";
   }
   if (calcolo.checked == true) {
     if (mfilt!="") mfilt+= "OR ";
     mfilt+= "INSTR(tag,'CALCOLO')>0 ";
   }
   if (mfilt!="") {
     mfilt="("+mfilt+") ";
    };
   mfilts="";
   if (BA.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'BA')>0  ";
   }
   if (BO.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'BO')>0  ";
   }
   if (CT.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'CT')>0  ";
   }
   if (FI.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'FI')>0  ";
   }
   if (GE.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'GE')>0  ";
   }
   if (LNF.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'LNF')>0  ";
   }
   if (LNL.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'LNL')>0  ";
   }
   if (MIB.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'MIB')>0  ";
   }
   if (NA.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'NA')>0  ";
   }
   if (PD.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PD')>0  ";
   }
   if (PG.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PG')>0  ";
   }
   if (PI.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PI')>0  ";
   }
   if (PV.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'PV')>0  ";
   }
   if (RM1.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'RM1')>0  ";
   }
   if (TO.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'TO')>0  ";
   }
   if (TS.checked == true) {
     if (mfilts!="") mfilts+= "OR ";
     mfilts+= "INSTR(sez,'TS')>0  ";
   }
   if (mfilts!="") {
      if (mfilt!=""){ mfilt+=" AND ";}; 	   
     mfilt+="("+mfilts+") ";
   }
   mfilts="";	  
   if (cms.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='cms' ";
   }
   if (fase2.checked == true) {
     if (mfilts!="") mfilts+= "AND ";
     mfilts+= "sigla='fase2' ";
   }
   if ((cms.checked != true) && (fase2.checked != true)) mfilts="sigla=''";
   if (mfilts!="") {
      if (mfilt!=""){ mfilt+=" AND ";}; 	   
     mfilt+="("+mfilts+") ";
   }
   if (missioni.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " capitolo='missioni' ";
   }
   if (consumo.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " capitolo='consumo' ";
   }
   if (inventario.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " capitolo='inventario' ";
   }
   if (apparati.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " capitolo='apparati' ";
   }
//   if (inventario.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='inventario' ";
//  }
//   if (trasporti.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='trasporti' ";
//   }
//   if (pubblicazioni.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='pubblicazioni' ";
//   }
// if (licenze-sw.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='licenze-sw' ";
//   }
// if (manutenzione.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='manutenzione' ";
//   }
// if (seminari.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='seminari' ";
//   }
// if (altroconsumo.checked == true) {
//     if (mfilt!="") mfilt+= "AND ";
//      mfilt+= " capitolo='altroconsumo' ";
//   }

   if (spservizi.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " capitolo='spservizi' ";
   }
   if (RN.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
      mfilt+= " rn is not null ";
   }
   if (p2024.checked == true) {
     if (mfilt!="") mfilt+= "AND ";
     mfilt+= " INSTR(tag,'P2024')>0 ";
   }
   lfilt="";
   if (core.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(TAG,'CORE')>0 ";
   }
   if (cata.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(note,'CAT A')>0 ";
   }
   if (catb.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(note,'CAT B')>0 ";
   }
   if (catc.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(note,'CAT C')>0 ";
   }
   if (preproto.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(tag,'PREPROTO')>0 ";
   }
   if (infra.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(tag,'INFRA')>0 ";
   }
   if (fasedue.checked == true) {
     if (lfilt!="") lfilt+= "OR ";
     lfilt+= " INSTR(tag,'FASE2')>0 ";
   }
   if (lfilt!="") mfilt+="AND ("+lfilt+") ";
   

   mtoke=0;
   if (asse.checked == true) {
      mtoke=1;
   }
   if (assgn.checked == true) {
      mtoke=10+mtoke;

   }
 
    xmlhttp.open("GET","allarefe.php?q="+str+"&f="+mfilt+"&t="+mtoke,true);
    xmlhttp.send();
  }
}
function showSingleRichie(str) {
  if (str == "") {
    document.getElementById("txtHint").innerHTML = "";
    return;
  } else {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
        document.getElementById("totrichieste").innerHTML = document.getElementById("phprich").innerHTML;
        document.getElementById("totkeur").innerHTML = document.getElementById("phpkeur").innerHTML;
        document.getElementById("totkeurSJ").innerHTML = document.getElementById("phpkeurSJ").innerHTML;
        document.getElementById("totassegna").innerHTML = document.getElementById("phpasse").innerHTML;
      }
      else {
	 if (this.readyState == 4 && this.status != 200)    document.getElementById('id03').style.display='block';
      };
    };
    xmlhttp.open("GET","unnarefe2.php?q="+str,true);
    xmlhttp.send();
  }
}

function insertRichie() {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("txtHint").innerHTML = this.responseText;
      }
      else {
	if (this.readyState == 4 && this.status != 200)    document.getElementById('id03').style.display='block';
      };
    };
    xmlhttp.open("GET","entra.html",true);
    xmlhttp.send();
}


</script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://webanalytics.web.cern.ch/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '639']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
<body onload="showRichie(richie.value);">
 <div class="w3-container w3-amber">
  <h1>Richieste CMS</h1>
</div> 
<form>
<!--
<select id="richie" onchange="showRichie(this.value);" onblur="this.selectedIndex = 0;">
-->

<div>  <br> </div>
<select class="w3-select, w3-quarter" id="richie" onchange="showRichie(this.value);" >
  <option value="0">Anno:</option>
  <option value="2025">2025</option>
  <option value="2024">2024</option>
    <option value="2023">2023</option>
    <option value="2022">2022</option>
    <option value="2021">2021</option>
    <option value="2020">2020</option>
    <option value="2019">2019</option>
    <option value="2018">2018</option>
    </select>
</form>
<div class="w3-right">
<label for="vai">Vai a CMS-ID:</label>
<input type="text" id="vai" onchange="showSingleRichie(this.value);">
<span> &nbsp   </span>
</div>

<br>
<table class="w3-table">
<tr>
<td>
<fieldset >
<legend> Sigla </legend>
<input type="radio" id="cms" name="sigla" value="cms"  onclick="showRichie(richie.value);">
<label for="cms">CMS</label>
<input type="radio" id="fase2" name="sigla" value="fase2"  onclick="showRichie(richie.value);">
<label for="fase2">Fase2</label>
</fieldset>
</td>
<td>
<fieldset>
<legend> Capitolo </legend>
<div class="chkdiv">
<input type="radio" id="missioni" name="capitolo" value="missioni" onclick="showRichie(richie.value);">
<label for="missioni">Missioni</label>
</div>
<div class="chkdiv">
<input type="radio" id="consumo" name="capitolo" value="consumo" onclick="showRichie(richie.value);">
<label for="consumo">Consumo</label>
</div>
<div class="chkdiv">
<input type="radio" id="inventario" name="capitolo" value="inventario" onclick="showRichie(richie.value);">
<label for="inventario">Inventario</label>
</div>
<div class="chkdiv">
<input type="radio" id="apparati" name="capitolo" value="apparati" onclick="showRichie(richie.value);">
<label for="apparati">Apparati</label>
</div>
<div class="chkdiv">
<input type="radio" id="spservizi" name="capitolo" value="spservizi" onclick="showRichie(richie.value);">
<label for="spservizi">spservizi</label>
</div>
<div class="chkdiv">
<input type="radio" id="Tutti" name="capitolo" value="spservizi" checked onclick="showRichie(richie.value);">
<label for="Tutti">Tutti</label>
</div>
</fieldset>
</td>
<td>
   <fieldset>
   <legend>Tags</legend>
   <div class="chkdiv">
     <input type="checkbox" id="core" name="core" value="core" onclick="showRichie(richie.value);">
     <label for="core">Core</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="cata" name="cata" value="cata" onclick="showRichie(richie.value);">
     <label for="cata">CAT A</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="catb" name="catb" value="catb" onclick="showRichie(richie.value);">
     <label for="catb">CAT B</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="catc" name="catc" value="catc" onclick="showRichie(richie.value);">
     <label for="catc">CAT C</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="preproto" name="preproto" value="preproto" onclick="showRichie(richie.value);">
     <label for="preproto">PreProto</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="infra" name="infra" value="infra" onclick="showRichie(richie.value);">
     <label for="infra">Infra</label>
   </div>
   <div class="chkdiv">
     <input type="checkbox" id="fasedue" name="fasedue" value="fasedue" onclick="showRichie(richie.value);">
     <label for="fasedue">Fase 2</label>
   </div>
   </fieldset>
</td>
</tr>
<tr>
<td>
<fieldset>
<legend> Subsystem </legend>
<div class="chkdiv">
<input type="checkbox" id="tk" name="TK" value="TK" onclick="showRichie(richie.value);">
<label for="tk">TK</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="ecal" name="ECAL" value="ECAL" onclick="showRichie(richie.value);">
<label for="ecal">ECAL</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="mtd" name="MTD" value="MTD" onclick="showRichie(richie.value);">
<label for="mtd">MTD</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="trig" name="TRIG" value="TRIG" onclick="showRichie(richie.value);">
<label for="trig">TRIG</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="mu" name="MU" value="MU" onclick="showRichie(richie.value);">
<label for="MU">MU</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="pps" name="PPS" value="PPS" onclick="showRichie(richie.value);">
<label for="PPS">PPS</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="bril" name="BRIL" value="BRIL" onclick="showRichie(richie.value);">
<label for="BRIL">BRIL</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="calcolo" name="CALCOLO" value="CALCOLO" onclick="showRichie(richie.value);">
<label for="calcolo">Calcolo</label>
</div>
</fieldset>
</td>
<td>
<fieldset>
<legend> Sezione </legend>
<div class="chkdiv">
<input type="checkbox" id="BA" name="BA" value="BA" onclick="showRichie(richie.value);">
<label for="BA">BA</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="BO" name="BO" value="BO" onclick="showRichie(richie.value);">
<label for="BOl">BO</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="CT" name="CT" value="CT" onclick="showRichie(richie.value);">
<label for="CT">CT</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="FI" name="FI" value="FI" onclick="showRichie(richie.value);">
<label for="FI">FI</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="GE" name="GE" value="GE" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="GE">GE</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="LNF" name="LNF" value="LNF" onclick="showRichie(richie.value);">
<label for="LNF">LNF</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="LNL" name="LNL" value="LNL" onclick="showRichie(richie.value);">
<label for="LNL">LNL</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="MIB" name="MIB" value="MIB" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="MIB">MIB</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="NA" name="NA" value="NA" onclick="showRichie(richie.value);">
<label for="NA">NA</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PD" name="PD" value="PD" onclick="showRichie(richie.value);">
<label for="PD">PD</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PG" name="PG" value="PG" onclick="showRichie(richie.value);">
</div>
<div class="chkdiv">
<label for="PG">PG</label>
<input type="checkbox" id="PI" name="PI" value="PI" onclick="showRichie(richie.value);">
<label for="PI">PI</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="PV" name="PV" value="PV" onclick="showRichie(richie.value);">
<label for="PV">PV</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="RM1" name="RM1" value="RM1" onclick="showRichie(richie.value);">
<label for="RM1">RM1</label>
</div>
<div class="chkdiv">
<input type="checkbox" id="TO" name="TO" value="TO" onclick="showRichie(richie.value);">
<label for="TO">TO</labeb>
</div>
<div class="chkdiv">
<input type="checkbox" id="TS" name="TS" value="TS" onclick="showRichie(richie.value);">
<label for="TO">TS</label>
</div>
</fieldset>
</td>
<td>
<fieldset>
<legend> Views </legend>
<div class="chkdiv">
<input type="hidden" id="RN">
<input type="hidden" id="asse">
<input type="checkbox" id="p2024" name="p2024" value="P2024" onclick="showRichie(richie.value);">
<label for="RN">P2024 </label>
</div>
<div class="chkdiv">
<input type="checkbox" id="assgn" name="assgn" value="assegnati" onclick="showRichie(richie.value);">
<label for="asse">Assegnazioni </label>
</div>
</fieldset>
</td>
<td>
</td>
</tr>
</table>

<!-- The Modal -->

<div id="id03" class="w3-modal">
  <div class="w3-modal-content">
    <div class="w3-container">
      <span onclick="document.getElementById('id03').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <p>Connection issues...</p>
      <p>Reload page and try to re-authenticate</p>
    </div>
  </div>
</div> 

<br>
<div id="txtHint"><b>Richieste...</b></div>
<div id="allafooter" class="allafooter">Num Richieste:<span id="totrichieste"></span> Tot Richieste:<span id="totkeur"></span><span> Tot SJ:</span><span id="totkeurSJ"></span> Ass.: <span id="totassegna"></span></div>
</body>
</html>
